
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Pixel Tamagotchi - ç†Šä»”">
    <title>Pixel Tamagotchi - ç†Šä»”</title>
    <style>
        body, html {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #fff8e1;
            color: #333;
            height: 100%;
            overflow-y: scroll;
        }

        .pixel-container {
            display: grid;
            grid-template-columns: repeat(10, 20px);
            gap: 2px;
            margin: 20px auto;
            width: max-content;
        }

        .pixel {
            width: 20px;
            height: 20px;
            background-color: #ddd;
        }

        .active {
            background-color: #8b4513;
        }

        .eye {
            background-color: #000;
        }

        .food {
            background-color: #ffa500;
        }

        .toilet {
            background-color: #008000;
        }

        .sleep {
            background-color: #222;
        }

        button, input {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
        }

        .status-container {
            margin: 20px auto;
            width: 300px;
        }

        .status-bar {
            margin: 10px 0;
            background-color: #ddd;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .status-bar-inner {
            height: 100%;
            background-color: #76c7c0;
            width: 0%;
            transition: width 0.5s;
        }

        .time-indicator, .age-indicator {
            font-size: 18px;
            margin: 10px 0;
            font-weight: bold;
        }

        .save-code-container {
            margin: 20px;
            font-size: 18px;
        }

        #load-code-input {
            font-size: 18px;
            margin: 10px;
        }

        #saved-code {
            font-size: 18px;
            margin-top: 10px;
        }

        .death-message {
            font-size: 24px;
            color: red;
            margin: 20px;
            font-weight: bold;
        }

    </style>
</head>
<body>
    <h1>Pixel Tamagotchi - ç†Šä»” v17</h1>
    <div id="pixel-pet" class="pixel-container"></div>
    <div>
        <button onclick="feedPet()">é¤µé£Ÿ</button>
        <button onclick="playWithPet()">é™ªç©</button>
        <button onclick="cleanPet()">æ¸…æ½”</button>
        <button onclick="restartGame()">é‡æ–°é–‹å§‹</button>
    </div>
    <div class="status-container">
        <div>è‚šé¤“ï¼š<div class="status-bar"><div id="hunger-bar" class="status-bar-inner"></div></div></div>
        <div>å»æ‰€ï¼š<div class="status-bar"><div id="toilet-bar" class="status-bar-inner"></div></div></div>
        <div>æ‚¶ï¼š<div class="status-bar"><div id="boredom-bar" class="status-bar-inner"></div></div></div>
    </div>
    <div class="time-indicator" id="time-indicator">ç¾åœ¨æ™‚é–“ï¼š00:00</div>
    <div class="age-indicator" id="age-indicator">é£¼é¤Šæ—¥æ•¸ï¼š0 æ—¥</div>
    <div class="death-message" id="death-message" style="display: none;">ç†Šä»”æ­»äº¡ï¼éŠæˆ²çµæŸ</div>

    <div class="save-code-container">
        <button onclick="saveGame()">å„²å­˜é€²åº¦</button>
        <div id="saved-code"></div>
    </div>

    <div>
        <input type="text" id="load-code-input" placeholder="è¼¸å…¥10ä½ä»£ç¢¼" maxlength="10">
        <button onclick="loadGame()">è¼‰å…¥é€²åº¦</button>
    </div>

    <script>
        const pixelPet = document.getElementById("pixel-pet");
        const hungerBar = document.getElementById("hunger-bar");
        const toiletBar = document.getElementById("toilet-bar");
        const boredomBar = document.getElementById("boredom-bar");
        const timeIndicator = document.getElementById("time-indicator");
        const ageIndicator = document.getElementById("age-indicator");
        const savedCodeDiv = document.getElementById("saved-code");
        const loadCodeInput = document.getElementById("load-code-input");
        const deathMessage = document.getElementById("death-message");

        let hunger = 0;
        let toilet = 0;
        let boredom = 0;
        let age = 0;
        let isSleeping = false;
        let currentState = "normal"; // ç”¨ä¾†è¿½è¹¤ç›®å‰ç‹€æ…‹
        let frameIndex = 0;
        let savedCode = "";
        let lastSavedTime = new Date().getTime(); // è®°å½•æœ€åä¸€æ¬¡ä¿å­˜çš„æ—¶é—´
        let lastLoadTime = 0; // è®°å½•è¼‰å…¥æ™‚é–“çš„æ™‚é–“æˆ³
        let lastGameTime = 0; // è®°å½•éŠæˆ²å¼€å§‹çš„æ™‚é–“

        const frames = {
            normal: [
                [
                    "..........",
                    "...####...",
                    "..######..",
                    "..#....#..",
                    "..#..O.#..",
                    "..######..",
                    "...#..#...",
                    "...####...",
                    "..........",
                    ".........."
                ]
            ],
            eating: [
                [
                    "..........",
                    "...####...",
                    "..######..",
                    "..#....#..",
                    "..#..O.#..",
                    "..##FOOD..",
                    "...#..#...",
                    "...####...",
                    "..........",
                    ".........."
                ]
            ],
            toilet: [
                [
                    "..........",
                    "...####...",
                    "..######..",
                    "..#....#..",
                    "..#.O..#..",
                    "..######..",
                    "...#ğŸ’§.#...",
                    "...####...",
                    "..........",
                    ".........."
                ]
            ],
            sleeping: [
                [
                    "..........",
                    "...ZZZZ...",
                    "..Z....Z..",
                    "..Z....Z..",
                    "...ZZZZ...",
                    "..........",
                    "..........",
                    "..........",
                    "..........",
                    ".........."
                ]
            ],
            playing: [
                [
                    "..........",
                    "...####...",
                    "..######..",
                    "..#....#..",
                    "..#..O.#..",
                    "..##PLAY..",
                    "...#..#...",
                    "...####...",
                    "..........",
                    ".........."
                ]
            ],
            dead: [
                [
                    "..........",
                    "...####...",
                    "..######..",
                    "..#....#..",
                    "..#....#..",
                    "..######..",
                    "...####...",
                    "...####...",
                    "..........",
                    ".........."
                ]
            ]
        };

        function createPixels() {
            for (let i = 0; i < 100; i++) {
                const pixel = document.createElement("div");
                pixel.classList.add("pixel");
                pixelPet.appendChild(pixel);
            }
        }

        function renderFrame(frameType) {
            const pixels = document.querySelectorAll(".pixel");
            const frame = frames[frameType][frameIndex % frames[frameType].length];
            const rows = frame.join("");
            for (let i = 0; i < pixels.length; i++) {
                if (rows[i] === "#") {
                    pixels[i].classList.add("active");
                } else if (rows[i] === "O") {
                    pixels[i].classList.add("eye");
                } else if (rows[i] === "F") {
                    pixels[i].classList.add("food");
                } else if (rows[i] === "ğŸ’§") {
                    pixels[i].classList.add("toilet");
                } else if (rows[i] === "Z") {
                    pixels[i].classList.add("sleep");
                } else if (rows[i] === "P") {
                    pixels[i].classList.add("play");
                } else {
                    pixels[i].classList.remove("active", "eye", "food", "toilet", "sleep", "play");
                }
            }
        }

        function updateStatusBars() {
            hungerBar.style.width = `${hunger}%`;
            toiletBar.style.width = `${toilet}%`;
            boredomBar.style.width = `${boredom}%`;
            timeIndicator.textContent = `ç¾åœ¨æ™‚é–“ï¼š${new Date().toLocaleTimeString()}`;
            ageIndicator.textContent = `é£¼é¤Šæ—¥æ•¸ï¼š${age} æ—¥`;
        }

        function updatePetStatus() {
            if (currentState !== "dead") {
                if (!isSleeping) {
                    hunger = Math.min(100, hunger + 1);
                    toilet = Math.min(100, toilet + 1);
                    boredom = Math.min(100, boredom + 1);
                }
            }
            updateStatusBars();
        }

        function updateRealTime() {
            const currentTime = new Date().getTime();
            if (currentTime - lastSavedTime > 24 * 60 * 60 * 1000) {
                age++;
                lastSavedTime = currentTime;
            }
            if (currentState === "sleeping") {
                frameIndex += 2;
            } else {
                frameIndex++;
            }
            renderFrame(currentState);
        }

        function feedPet() {
            if (currentState !== "dead") {
                hunger = Math.max(0, hunger - 20);
                currentState = "eating";
                setTimeout(() => (currentState = "normal"), 3000);
            }
        }

        function playWithPet() {
            if (currentState !== "dead") {
                boredom = Math.max(0, boredom - 20);
                currentState = "playing";
                setTimeout(() => (currentState = "normal"), 3000);
            }
        }

        function cleanPet() {
            if (currentState !== "dead") {
                toilet = Math.max(0, toilet - 20);
                currentState = "toilet";
                setTimeout(() => (currentState = isSleeping ? "sleeping" : "normal"), 3000);
            }
        }

        function restartGame() {
            hunger = 0;
            toilet = 0;
            boredom = 0;
            age = 0;
            deathMessage.style.display = "none";
            currentState = "normal";
            frameIndex = 0;
            renderFrame(currentState);
            updateRealTime();
        }

        function saveGame() {
            const gameData = `${hunger},${toilet},${boredom},${age},${new Date().getTime()}`;
            savedCode = generateSaveCode(); // Generate the 10 character save code
            savedCodeDiv.textContent = `å„²å­˜ä»£ç¢¼ï¼š${savedCode}`; // é¡¯ç¤ºå®Œæ•´çš„ä»£ç¢¼
            localStorage.setItem(savedCode, gameData);  // Store game data under the generated code
        }

        function generateSaveCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+';
            let saveCode = '';
            for (let i = 0; i < 10; i++) {
                saveCode += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return saveCode;
        }

        function loadGame() {
            const code = loadCodeInput.value;
            if (code.length !== 10) {
                alert("ç„¡æ•ˆçš„ä»£ç¢¼ï¼Œè«‹ç¢ºä¿ä»£ç¢¼é•·åº¦ç‚º10ä½ï¼");
                return;
            }

            const savedData = localStorage.getItem(code);
            if (savedData) {
                const [hungerValue, toiletValue, boredomValue, ageValue, lastSavedTimeValue] = savedData.split(",");
                hunger = parseInt(hungerValue, 10);
                toilet = parseInt(toiletValue, 10);
                boredom = parseInt(boredomValue, 10);
                age = parseInt(ageValue, 10);
                lastSavedTime = parseInt(lastSavedTimeValue, 10);
                alert("éŠæˆ²å·²è¼‰å…¥ï¼");
                restartGame();
            } else {
                alert("ç„¡æ•ˆçš„ä»£ç¢¼ï¼");
            }
        }

        createPixels();
        setInterval(updateRealTime, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡æ™‚é–“
        setInterval(updatePetStatus, 1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡ç‹€æ…‹
        setInterval(() => renderFrame(currentState), 300); // æ¯300æ¯«ç§’æ›´æ–°ä¸€æ¬¡å‹•ç•«
    </script>
</body>
</html>
